<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Min Search</title>
</head>
<body>
<h2>Min Search</h2>
  <canvas id="minCanvas" width="650" height="400" style="border:1px solid black"></canvas>
  <script type="module">
    import {matrixvis} from "../src/index.js";
    const canvas = new matrixvis.CanvasRenderer("minCanvas");
    const min = new matrixvis.MatrixElement("min", 0, false, true);
    min.x = 50;
    min.y = 100;
    min.setSize(50,50);
    canvas.add(min, "min");

    const A = new matrixvis.Matrix("A", [[0,0,0],[],[]], true);
    A.x = 200;
    A.y = 100;
    A.setSize(50,50);
    A.randomize(1,10);
    canvas.add(A,"A");

    const code = new matrixvis.MatrixCode(["min = A[0][0]", "FOR i = 0 to 2", " FOR y = 0 to 2", "    IF min > A[i][j]","       min = A[i][j]" ]);
    code.x = 400;
    code.y = 100
    canvas.add(code, "code");

    canvas.vars.i = 0;
    canvas.vars.j = 0

    const firstStep = () => {
      canvas.get("code").selected = [0];
      canvas.copy(canvas.get("A").elements[0][0], canvas.get("min"))
      canvas.get("A").deleteAllIndexes();
    }

    const secondStep = () => {
      canvas.get("code").selected = [1];
      canvas.get("A").setRowIndexes("i", canvas.vars.i);
      canvas.get("A").setRowLoopMarkers("i", 0, 2)
      return 200;
    }

    const thirdStep = () => {
      canvas.get("code").selected = [2];
      canvas.get("A").setColIndexes("j", canvas.vars.j);
      canvas.get("A").setColLoopMarkers("j", 0, 2);
      canvas.vars.j++
      return 200;
    }

    const minCopyStep = () => {
      if(canvas.get("min").value > canvas.get("A").elements[canvas.vars.i][canvas.vars.j].value){
        canvas.get("code").selected = [3];
        canvas.copy(canvas.get("A").elements[canvas.vars.i][canvas.vars.j], canvas.get("min"));
      } else {
        return 200;
      }
    }
    const findMinCompare = function () {
      canvas.get("code").selected = [3];
      canvas.compare(canvas.get("min"), canvas.get("A").elements[canvas.vars.i][canvas.vars.j]);
      canvas.get("A").setColIndexes("j", canvas.vars.j);
    }

    const increaseJ = () => {
      canvas.vars.j++;
      canvas.get("code").selected = [2];
      if (checkJ()) {
        return 200;
      } else {
        return 0;
      }
    }

    const increaseI = () => {
      canvas.vars.i++;
      canvas.get("A").setRowIndexes("i", canvas.vars.i);
      canvas.vars.j = 0;
      canvas.get("code").selected = [1];
      if (checkI()) {
        return 200;
      } else {
        return 0;
      }
    }

    const checkJ = () => {
      return canvas.vars.j < canvas.get("A").elements[0].length
    }

    const checkI = () => {
      return canvas.vars.i < canvas.get("A").elements.length
    }

    const minFinalStep = () => {
      canvas.stopComparingAndCopying();
      canvas.get("A").deleteAllIndexes();
      canvas.get("code").selected = [];
      canvas.get("min").setGreenColor();
    }

    canvas.setSteps(
            [firstStep,
              secondStep,
              thirdStep,
              [[findMinCompare,minCopyStep, increaseJ],
                checkJ, increaseI],
              checkI,
              minFinalStep]
    )
  </script>
</body>
</html>